<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>LINE情報入力フォーム</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
    <h2>LINE IDと個人情報を入力してください</h2>
    <form id="infoForm">
        <label for="name">個人名：</label>
        <input type="text" id="name" placeholder="個人名" required><br><br>
        <label for="company">企業名：</label>
        <input type="text" id="company" placeholder="企業名" required><br><br>
        <button type="button" onclick="sendData()">送信</button>
    </form>

    <script>
        async function sendData() {
            // LIFFの初期化
            await liff.init({ liffId: "2006951148-WNJM4Ldq" });

            // ユーザーのLINEプロフィール情報を取得
            const profile = await liff.getProfile();
            const lineId = profile.userId;  // LINE ID
            //const lineId = "1234";  // LINE ID (デバッグ用に固定)

            // フォームの入力内容を取得
            const name = document.getElementById("name").value;
            const company = document.getElementById("company").value;

            // GASにPOSTリクエストを送信
            const data = new URLSearchParams();
            data.append('lineId', lineId);
            data.append('name', name);
            data.append('company', company);

            fetch("https://script.google.com/macros/s/AKfycbyF-mq56u8BH24ZHiqZLVUFgbbfjmKomBnYg_iY34XBtM8QMNSijZu26XI4x27KIggiQg/exec", { 
                method: "POST",
                headers: { 
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: data
            })
            .then(response => response.text())  // JSON でなくプレーンテキストとして処理
            .then(result => {
                alert("情報が送信されました！");
                document.getElementById("infoForm").reset();
            })
            .catch(error => {
                // CORSエラーの判定
                if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
                     console.warn("CORSエラーが発生しましたが、データは送信されています。");
                    // CORSエラーを無視して処理を続ける
                    //alert("CORSエラーが発生しましたが、データは送信されました。");
                    document.getElementById("infoForm").reset();
                } else {
                  console.error("予期しないエラー:", error);
                    alert("送信に失敗しました。");
                }});
        }
    </script>
</body>
</html>
